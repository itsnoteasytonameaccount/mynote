<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>星际争霸2api库编译记录 | 土壤细流</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" type="text/css" href="/mynote/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />

  <meta name="generator" content="土壤细流">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml">
  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="rss.xml">
  
  

  
</head>


<body class="post-template">

  <header class="site-head"  style="background-image: url(/mynote/image/cover.jpg)" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/mynote/"><img src="https://avatars.githubusercontent.com/u/26755276" alt="Blog Logo"/></a> 
            <h1 class="blog-title">土壤细流</h1>
            <h2 class="blog-description"></h2>
        </div>
    </div>
</header>
  

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2021-08-17T16:00:00.000Z" itemprop="datePublished">
          2021-08-18
      </time>
    
    
    | 
    <a href='/mynote/tags/c/'>c++</a>
    
    
</span>
    <h1 class="post-title">星际争霸2api库编译记录</h1>
    <section class="post-content">
      <link rel="stylesheet" href="/mynote/css/katex.min.css" /><p>据网上说rts游戏常被用来进行深度学习方面的研究</p>
<a id="more"></a>
<h1>版本</h1>
<p>先介绍一下各个版本</p>
<h2 id="pysc2">pysc2</h2>
<p>这个是社区作者提供的python版本api，提供编写自己机器人的python环境，文档不齐全，<a href="https://github.com/deepmind/pysc2" target="_blank" rel="noopener">https://github.com/deepmind/pysc2</a><br>
这是我找到的还算可以的<a href="https://www.jianshu.com/p/9f7c3cd83bf0" target="_blank" rel="noopener">介绍博客</a></p>
<h2 id="s2client-api">s2client-api</h2>
<p><a href="https://github.com/Blizzard/s2client-api" target="_blank" rel="noopener">s2client-api</a><br>
这个是官方提供的c语言api库，文档是代码注释自动生成的，烂的一比，代码里还有bug一直没改</p>
<h2 id="s2client-proto">s2client-proto</h2>
<p><a href="https://github.com/Blizzard/s2client-proto" target="_blank" rel="noopener">s2client-proto</a><br>
这里有接口相关的定义，以及资源汇总，不愿用官方提供的api的，直接自己写调数据接口的方法也可以，好像要用websocket调</p>
<h1>准备环境</h1>
<p>使用的是s2client-api<br>
本人是windows系统，因此下文的都是windows下的操作，其他环境参考官方文档</p>
<p>官网已有介绍vs studio17下的配置方式，但出于某些原因实在不愿意用vs，使用命令行编译。</p>
<p>cmake，mingw64，星际争霸游戏本体<br>
mingw64和cmake的安装只要到相应的网址下安装包，或已经编译好的windows下的可移植（portable）文件即可，个人建议直接下可以指文件，便于掌握安装位置和便于自己决定如何改变环境</p>
<h1>编译s2client-api库</h1>
<p>用<code>git</code>命令下载好s2client-api，必须加<code>--recursive</code>参数将相关依赖都下下来</p>
<p>然后进到s2client-api创建build文件夹，在build文件夹打开cmake-gui，点击configure生成配置选项后，根据需要勾选（一般不用修改，况且这玩意甚至没有编译成动态库的选项）,之后点击generate生成makefile文件</p>
<p>最后在build文件夹下执行mingw32-make命令，这样一般会提示缺少一个EGL.h文件，说实话我不知道这是什么，应该是图形相关头文件。用everything搜索我本地环境的emscripten编译器正好有这个头文件，本地没有的可能需要百度百度。</p>
<p>找到egl.h后需要需要将头文件路径设置为<code>C_INCLUDE_PATH</code>这个环境变量<br>
命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> C_INCLUDE_PATH=xxx</span><br></pre></td></tr></table></figure>
<p>直接在mingw32-make命令后加参数无效，因为makefile文件中有很多子编译，要想所有地方都能感知到，只能加到环境便令</p>
<p>然后重新make，就可以在<code>build/bin</code>文件夹下找到对应的动态库了</p>
<h2 id="枚举数据设置问题">枚举数据设置问题</h2>
<p>但实际上依赖这些库编译出来的程序是会出问题的，具体问题是接口返回的数据标志，和代码中预期的数据标志不一致，导致程序停止监听，需要修改源码</p>
<p>具体问题见如下链接<br>
<a href="https://github.com/Blizzard/s2client-api/pull/306" target="_blank" rel="noopener">https://github.com/Blizzard/s2client-api/pull/306</a><br>
<a href="https://github.com/Blizzard/s2client-api/issues/310" target="_blank" rel="noopener">https://github.com/Blizzard/s2client-api/issues/310</a><br>
<a href="https://github.com/Blizzard/s2client-api/issues/315" target="_blank" rel="noopener">https://github.com/Blizzard/s2client-api/issues/315</a></p>
<p>需要进行的修改见如下链接</p>
<p><a href="https://github.com/Blizzard/s2client-api/pull/306/commits/7e2cb8f2b2a49f188380f051cf5fcd72ca94540d" target="_blank" rel="noopener">https://github.com/Blizzard/s2client-api/pull/306/commits/7e2cb8f2b2a49f188380f051cf5fcd72ca94540d</a><br>
<a href="https://github.com/peter-cudmore/s2client-api/commit/0a79825bd1c6318debb56082b9142f4940b7d73c" target="_blank" rel="noopener">https://github.com/peter-cudmore/s2client-api/commit/0a79825bd1c6318debb56082b9142f4940b7d73c</a></p>
<h1>编写自己的程序并编译</h1>
<p>编写自己的程序请参看官方文档，</p>
<p>示例代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sc2api/sc2_api.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sc2utils/sc2_manage_process.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sc2;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bot</span> :</span> <span class="keyword">public</span> Agent</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/* data */</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnGameStart</span><span class="params">()</span> final</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"hello world"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnStep</span><span class="params">()</span> final</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnUnitIdle</span><span class="params">(<span class="keyword">const</span> Unit *myunit)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"idle"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnUnitCreated</span><span class="params">(<span class="keyword">const</span> Unit *myunit)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"created"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Coordinator coordinator;</span><br><span class="line">    Bot bot;</span><br><span class="line">    Bot bot2;</span><br><span class="line">    <span class="comment">// 必须，否则无法检测到游戏本体的路径</span></span><br><span class="line">    <span class="keyword">if</span> (!coordinator.LoadSettings(argc, argv))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"load failed"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    coordinator.SetRealtime(<span class="literal">true</span>);</span><br><span class="line">    coordinator.SetParticipants(&#123;CreateParticipant(Race::Terran, &amp;bot),</span><br><span class="line">                                 CreateParticipant(Race::Terran, &amp;bot2)&#125;);</span><br><span class="line"></span><br><span class="line">    coordinator.LaunchStarcraft();</span><br><span class="line">    coordinator.StartGame(sc2::kMapBelShirVestigeLE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (coordinator.Update())</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译时需要引入的库示例如下（下面时vs code的task配置文件，应该不难看懂，其中${}包括的内容是vscode内置变量，用于读取源文件名或环境变量）</p>
<p>示例配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"label"</span>: <span class="string">"build folder"</span>,</span><br><span class="line">    <span class="attr">"group"</span>: <span class="string">"build"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"g++"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [</span><br><span class="line">        <span class="string">"$&#123;relativeFileDirname&#125;/*$&#123;fileExtname&#125;"</span>,</span><br><span class="line">        <span class="string">"-static"</span>,</span><br><span class="line">        <span class="string">"-L"</span>,</span><br><span class="line">        <span class="string">"%LD_LIBRARY_PATH%"</span>,</span><br><span class="line">        <span class="string">"-lsc2api"</span>,</span><br><span class="line">        <span class="string">"-lsc2lib"</span>,</span><br><span class="line">        <span class="string">"-lsc2utils"</span>,</span><br><span class="line">        <span class="string">"-lsc2protocol"</span>,</span><br><span class="line">        <span class="string">"-lprotobuf"</span>,</span><br><span class="line">        <span class="string">"-lcivetweb"</span>,</span><br><span class="line">        // 额外引入的库，civetweb依赖这个</span><br><span class="line">        <span class="string">"-lws2_32"</span>,</span><br><span class="line">        <span class="string">"-o"</span>,</span><br><span class="line">        <span class="string">"$&#123;relativeFileDirname&#125;.exe"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"options"</span>: &#123;</span><br><span class="line">        <span class="attr">"env"</span>: &#123;</span><br><span class="line">            <span class="attr">"CPLUS_INCLUDE_PATH"</span>: <span class="string">"$&#123;env:ENV_PATH&#125;/s2client-api/include;$&#123;env:ENV_PATH&#125;/s2client-api/build/generated;$&#123;env:ENV_PATH&#125;/s2client-api/contrib/protobuf/src"</span>,</span><br><span class="line">            <span class="attr">"LD_LIBRARY_PATH"</span>: <span class="string">"$&#123;env:ENV_PATH&#125;/s2client-api/build/bin"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"problemMatcher"</span>: <span class="string">"$gcc"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h1>commandCenter</h1>
<p><a href="https://github.com/davechurchill/CommandCenter" target="_blank" rel="noopener">CommandCenter</a><br>
这是其他人编写的可以配置的机器人</p>
<p>遇到上文的<em>枚举数据设置</em>问题时是在没有办法只能试试这个，然而这个编译起来也很麻烦。最后这个也没法正常执行，说明了是静态库出了问题。</p>
<p>同样先<code>git clone</code>下载源码</p>
<p>首先要编译sc2client-api好静态库，然后将<code>s2client-api/build/generated</code>,<code>s2client-api/include</code>,<code>s2client-api/contrib/protobuf/src</code>三个路径下的头文件放到mingw64的安装目录下的include文件夹下，具体结构参考<a href="https://github.com/davechurchill/CommandCenter" target="_blank" rel="noopener">CommandCenter</a>的linux下的编译方法说明部分。这样做是为了configure时能找到头文件。</p>
<p>然后库的引用路径必须要改cmake文件，找到commandCenter/cmake/FindSC2Api.cmake，将54行左右修改成如下(修改了PATHS部分的静态库搜索路径，并且在foreach循环后面添加了一个ws2_32库，civetweb需要)</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Search for SC2Api libraries.</span></span><br><span class="line"><span class="keyword">foreach</span>(COMPONENT sc2api sc2lib sc2utils sc2protocol civetweb protobuf ws2_32)</span><br><span class="line">    <span class="keyword">string</span>(TOUPPER <span class="variable">$&#123;COMPONENT&#125;</span> UPPERCOMPONENT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">find_library</span>(SC2Api_<span class="variable">$&#123;UPPERCOMPONENT&#125;</span>_LIB</span><br><span class="line">        NAMES</span><br><span class="line">            <span class="string">"$&#123;COMPONENT&#125;"</span></span><br><span class="line">        PATHS</span><br><span class="line">            <span class="string">"D:/environment/mingw64/lib"</span></span><br><span class="line">            <span class="string">"D:/environment/mingw64/lib"</span></span><br><span class="line">        PATH_SUFFIXES</span><br><span class="line">            <span class="string">"sc2api"</span></span><br><span class="line">        NO_DEFAULT_PATH</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(SC2Api_<span class="variable">$&#123;UPPERCOMPONENT&#125;</span>_LIB)</span><br><span class="line">        <span class="keyword">mark_as_advanced</span>(SC2Api_<span class="variable">$&#123;UPPERCOMPONENT&#125;</span>_LIB)</span><br><span class="line">        list(APPEND SC2Api_LIBRARIES <span class="string">"$&#123;SC2Api_$&#123;UPPERCOMPONENT&#125;_LIB&#125;"</span>)</span><br><span class="line">    <span class="keyword">else</span>()</span><br><span class="line">        <span class="keyword">message</span>(STATUS <span class="variable">$&#123;COMPONENT&#125;</span> <span class="string">" not found!"</span>)</span><br><span class="line">        <span class="keyword">set</span>(SC2Api_FOUND <span class="keyword">FALSE</span>)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<p>然后就可以新建一个build目录在其下通过cmake-gui生成makefile文件后，执行mingw32-make</p>
<p>最后在build/bin下找到可执行文件，执行（执行时所在目录下需要有BotConfig.txt）</p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>flyingfisherman</h4>
    <p>千里始足下，高山起微尘。吾道亦如此，行之贵日新</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?url=https://github.flyingfishman.io/mynote/2021/08/18/sc2api/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://github.flyingfishman.io/mynote/2021/08/18/sc2api/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=https://github.flyingfishman.io/mynote/2021/08/18/sc2api/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>
    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/mynote/2021/07/19/整数拆分/">
        整数拆分和最大公约数 →
    </a>
    
</nav>
  <div id="comment" class="comments-area">
    <h1 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h1>

    
</div>
</main>


  
<footer class="site-footer">
  
  <a class="subscribe icon-feed" href="/rss.xml"><span class="tooltip">Subscribe!</span></a>
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/mynote/">土壤细流</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

  <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.js"></script>

<script type="text/javascript" src="/mynote/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/mynote/js/index.js"></script>






</body>
</html>
